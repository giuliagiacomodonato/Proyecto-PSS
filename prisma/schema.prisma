generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                  Int                @id @default(autoincrement())
  rol                 RolUsuario
  nombre              String
  dni                 String             @unique
  fechaNacimiento     DateTime
  email               String
  telefono            String
  contrase√±a         String?
  fechaAlta           DateTime           @default(now())
  tipoSocio           TipoSocio?
  direccion           String?
  familiarId          Int?
  practicaDeportivaId Int?
  planFamiliarId      String?
  esMenorDe12         Boolean            @default(false)
  asistencias         Asistencia[]
  cuotas              Cuota[]
  inscripciones       Inscripcion[]
  pagos               Pago[]
  turnos              Turno[]
  familiar            Usuario?           @relation("SocioFamiliar", fields: [familiarId], references: [id])
  familiares          Usuario[]          @relation("SocioFamiliar")
  practicaDeportiva   PracticaDeportiva? @relation(fields: [practicaDeportivaId], references: [id])
  bajasRealizadas     UsuarioBaja[]

  @@map("usuarios")
}

model PracticaDeportiva {
  id            Int           @id @default(autoincrement())
  nombre        String        @unique
  descripcion   String
  precio        Int
  cupo          Int
  asistencias   Asistencia[]
  canchas       Cancha[]
  horarios      Horario[]
  inscripciones Inscripcion[]
  entrenadores  Usuario[]

  @@map("practicas_deportivas")
}

model Horario {
  id                  Int               @id @default(autoincrement())
  dia                 DiaSemana
  horaInicio          String
  horaFin             String
  practicaDeportivaId Int
  practicaDeportiva   PracticaDeportiva @relation(fields: [practicaDeportivaId], references: [id], onDelete: Cascade)

  @@map("horarios")
}

model Cancha {
  id                  Int                @id @default(autoincrement())
  ubicacion           String
  precio              Int
  practicaDeportivaId Int?
  tipo                TipoCancha
  nombre              String             @unique
  practicaDeportiva   PracticaDeportiva? @relation(fields: [practicaDeportivaId], references: [id])
  horarios            HorarioCancha[]
  turnos              Turno[]

  @@map("canchas")
}

model HorarioCancha {
  id         Int    @id @default(autoincrement())
  canchaId   Int
  horaInicio String
  horaFin    String
  cancha     Cancha @relation(fields: [canchaId], references: [id], onDelete: Cascade)

  @@map("horarios_cancha")
}

model Turno {
  id             Int      @id @default(autoincrement())
  canchaId       Int
  horaInicio     String
  fecha          DateTime
  reservado      Boolean  @default(false)
  usuarioSocioId Int?
  pagos          Pago[]
  cancha         Cancha   @relation(fields: [canchaId], references: [id], onDelete: Cascade)
  usuarioSocio   Usuario? @relation(fields: [usuarioSocioId], references: [id])

  @@map("turnos")
}

model UsuarioBaja {
  id                     Int        @id @default(autoincrement())
  usuarioEliminadoId     Int
  usuarioEliminadoNombre String
  usuarioEliminadoDni    String
  usuarioEliminadoEmail  String
  rolUsuarioEliminado    RolUsuario
  fechaBaja              DateTime   @default(now())
  motivo                 String?
  realizadoPorId         Int?
  realizadoPorDni        String
  realizadoPorNombre     String
  realizadoPor           Usuario?   @relation(fields: [realizadoPorId], references: [id])

  @@map("usuarios_bajas")
}

model Inscripcion {
  id                  Int               @id @default(autoincrement())
  usuarioSocioId      Int
  practicaDeportivaId Int
  fechaInscripcion    DateTime          @default(now())
  activa              Boolean           @default(true)
  asistencias         Asistencia[]
  practicaDeportiva   PracticaDeportiva @relation(fields: [practicaDeportivaId], references: [id], onDelete: Cascade)
  usuarioSocio        Usuario           @relation(fields: [usuarioSocioId], references: [id], onDelete: Cascade)
  pagos               Pago[]

  @@unique([usuarioSocioId, practicaDeportivaId])
  @@map("inscripciones")
}

model Asistencia {
  id                  Int               @id @default(autoincrement())
  inscripcionId       Int
  usuarioSocioId      Int
  practicaDeportivaId Int
  fecha               DateTime          @default(now())
  presente            Boolean           @default(false)
  inscripcion         Inscripcion       @relation(fields: [inscripcionId], references: [id], onDelete: Cascade)
  practicaDeportiva   PracticaDeportiva @relation(fields: [practicaDeportivaId], references: [id], onDelete: Cascade)
  usuarioSocio        Usuario           @relation(fields: [usuarioSocioId], references: [id], onDelete: Cascade)

  @@map("asistencias")
}

model Cuota {
  id               Int      @id @default(autoincrement())
  usuarioSocioId   Int
  mes              Int
  anio             Int
  monto            Int
  fechaVencimiento DateTime
  usuarioSocio     Usuario  @relation(fields: [usuarioSocioId], references: [id], onDelete: Cascade)
  pagos            Pago[]

  @@unique([usuarioSocioId, mes, anio])
  @@map("cuotas")
}

model Pago {
  id             Int          @id @default(autoincrement())
  usuarioSocioId Int
  tipoPago       TipoPago
  turnoId        Int?
  cuotaId        Int?
  inscripcionId  Int?
  monto          Int
  fechaPago      DateTime     @default(now())
  metodoPago     MetodoPago
  estado         EstadoPago   @default(PENDIENTE)
  comprobante    String?
  cuota          Cuota?       @relation(fields: [cuotaId], references: [id], onDelete: Cascade)
  inscripcion    Inscripcion? @relation(fields: [inscripcionId], references: [id], onDelete: Cascade)
  turno          Turno?       @relation(fields: [turnoId], references: [id], onDelete: Cascade)
  usuarioSocio   Usuario      @relation(fields: [usuarioSocioId], references: [id], onDelete: Cascade)

  @@map("pagos")
}

enum RolUsuario {
  ADMIN
  SOCIO
  ENTRENADOR
  SUPER_ADMIN
}

enum TipoSocio {
  INDIVIDUAL
  FAMILIAR
}

enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO
}

enum TipoCancha {
  FUTBOL_5
  FUTBOL
  BASQUET
}

enum EstadoPago {
  PENDIENTE
  PAGADO
  VENCIDO
  CANCELADO
}

enum TipoPago {
  RESERVA_CANCHA
  CUOTA_MENSUAL
  PRACTICA_DEPORTIVA
  CUOTA_PRACTICA
}

enum MetodoPago {
  EFECTIVO
  TARJETA_DEBITO
  TARJETA_CREDITO
  TRANSFERENCIA
}

model EmailLog {
  id         Int      @id @default(autoincrement())
  toAddress  String
  subject    String
  bodyText   String?
  bodyHtml   String?
  messageId  String?
  previewUrl String?
  status     String   @default("PENDING")
  error      String?
  tipo       String?
  meta       Json?
  createdAt  DateTime @default(now())

  @@map("email_logs")
}